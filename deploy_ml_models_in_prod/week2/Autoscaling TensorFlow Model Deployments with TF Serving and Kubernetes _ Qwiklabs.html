
<!DOCTYPE html>
<html lang='en'>
<head>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"caff0d62ed","applicationID":"587285446","transactionName":"IQ1XRUEOVV1dFxlRXAEXSlRATkpZVxI=","queueTime":0,"applicationTime":181,"agent":""}</script>
<script type="text/javascript">(window.NREUM||(NREUM={})).init={ajax:{deny_list:["bam.nr-data.net"]}};(window.NREUM||(NREUM={})).loader_config={licenseKey:"caff0d62ed",applicationID:"587285446"};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var i=e[n]={exports:{}};t[n][0].call(i.exports,function(e){var i=t[n][1][e];return r(i||e)},i,i.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<n.length;i++)r(n[i]);return r}({1:[function(t,e,n){function r(){}function i(t,e,n,r){return function(){return s.recordSupportability("API/"+e+"/called"),o(t+e,[u.now()].concat(c(arguments)),n?null:this,r),n?void 0:this}}var o=t("handle"),a=t(10),c=t(11),f=t("ee").get("tracer"),u=t("loader"),s=t(4),d=NREUM;"undefined"==typeof window.newrelic&&(newrelic=d);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],l="api-",v=l+"ixn-";a(p,function(t,e){d[e]=i(l,e,!0,"api")}),d.addPageAction=i(l,"addPageAction",!0),d.setCurrentRouteName=i(l,"routeName",!0),e.exports=newrelic,d.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(t,e){var n={},r=this,i="function"==typeof e;return o(v+"tracer",[u.now(),t,n],r),function(){if(f.emit((i?"":"no-")+"fn-start",[u.now(),r,i],n),i)try{return e.apply(this,arguments)}catch(t){throw f.emit("fn-err",[arguments,this,t],n),t}finally{f.emit("fn-end",[u.now()],n)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){m[e]=i(v,e)}),newrelic.noticeError=function(t,e){"string"==typeof t&&(t=new Error(t)),s.recordSupportability("API/noticeError/called"),o("err",[t,u.now(),!1,e])}},{}],2:[function(t,e,n){function r(t){if(NREUM.init){for(var e=NREUM.init,n=t.split("."),r=0;r<n.length-1;r++)if(e=e[n[r]],"object"!=typeof e)return;return e=e[n[n.length-1]]}}e.exports={getConfiguration:r}},{}],3:[function(t,e,n){var r=!1;try{var i=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",null,i),window.removeEventListener("testPassive",null,i)}catch(o){}e.exports=function(t){return r?{passive:!0,capture:!!t}:!!t}},{}],4:[function(t,e,n){function r(t,e){var n=[a,t,{name:t},e];return o("storeMetric",n,null,"api"),n}function i(t,e){var n=[c,t,{name:t},e];return o("storeEventMetrics",n,null,"api"),n}var o=t("handle"),a="sm",c="cm";e.exports={constants:{SUPPORTABILITY_METRIC:a,CUSTOM_METRIC:c},recordSupportability:r,recordCustom:i}},{}],5:[function(t,e,n){function r(){return c.exists&&performance.now?Math.round(performance.now()):(o=Math.max((new Date).getTime(),o))-a}function i(){return o}var o=(new Date).getTime(),a=o,c=t(12);e.exports=r,e.exports.offset=a,e.exports.getLastTimestamp=i},{}],6:[function(t,e,n){function r(t){return!(!t||!t.protocol||"file:"===t.protocol)}e.exports=r},{}],7:[function(t,e,n){function r(t,e){var n=t.getEntries();n.forEach(function(t){"first-paint"===t.name?p("timing",["fp",Math.floor(t.startTime)]):"first-contentful-paint"===t.name&&p("timing",["fcp",Math.floor(t.startTime)])})}function i(t,e){var n=t.getEntries();if(n.length>0){var r=n[n.length-1];if(f&&f<r.startTime)return;p("lcp",[r])}}function o(t){t.getEntries().forEach(function(t){t.hadRecentInput||p("cls",[t])})}function a(t){if(t instanceof g&&!y){var e=Math.round(t.timeStamp),n={type:t.type};e<=l.now()?n.fid=l.now()-e:e>l.offset&&e<=Date.now()?(e-=l.offset,n.fid=l.now()-e):e=l.now(),y=!0,p("timing",["fi",e,n])}}function c(t){"hidden"===t&&(f=l.now(),p("pageHide",[f]))}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var f,u,s,d,p=t("handle"),l=t("loader"),v=t(9),m=t(3),g=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){u=new PerformanceObserver(r);try{u.observe({entryTypes:["paint"]})}catch(h){}s=new PerformanceObserver(i);try{s.observe({entryTypes:["largest-contentful-paint"]})}catch(h){}d=new PerformanceObserver(o);try{d.observe({type:"layout-shift",buffered:!0})}catch(h){}}if("addEventListener"in document){var y=!1,w=["click","keydown","mousedown","pointerdown","touchstart"];w.forEach(function(t){document.addEventListener(t,a,m(!1))})}v(c)}},{}],8:[function(t,e,n){function r(t,e){if(!i)return!1;if(t!==i)return!1;if(!e)return!0;if(!o)return!1;for(var n=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var c=navigator.userAgent,f=c.match(a);f&&c.indexOf("Chrome")===-1&&c.indexOf("Chromium")===-1&&(i="Safari",o=f[1])}e.exports={agent:i,version:o,match:r}},{}],9:[function(t,e,n){function r(t){function e(){t(c&&document[c]?document[c]:document[o]?"hidden":"visible")}"addEventListener"in document&&a&&document.addEventListener(a,e,i(!1))}var i=t(3);e.exports=r;var o,a,c;"undefined"!=typeof document.hidden?(o="hidden",a="visibilitychange",c="visibilityState"):"undefined"!=typeof document.msHidden?(o="msHidden",a="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(o="webkitHidden",a="webkitvisibilitychange",c="webkitVisibilityState")},{}],10:[function(t,e,n){function r(t,e){var n=[],r="",o=0;for(r in t)i.call(t,r)&&(n[o]=e(r,t[r]),o+=1);return n}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],11:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(i<0?0:i);++r<i;)o[r]=t[e+r];return o}e.exports=r},{}],12:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(t,e,n){function r(){}function i(t){function e(t){return t&&t instanceof r?t:t?u(t,f,a):a()}function n(n,r,i,o,a){if(a!==!1&&(a=!0),!l.aborted||o){t&&a&&t(n,r,i);for(var c=e(i),f=m(n),u=f.length,s=0;s<u;s++)f[s].apply(c,r);var p=d[w[n]];return p&&p.push([b,n,r,c]),c}}function o(t,e){y[t]=m(t).concat(e)}function v(t,e){var n=y[t];if(n)for(var r=0;r<n.length;r++)n[r]===e&&n.splice(r,1)}function m(t){return y[t]||[]}function g(t){return p[t]=p[t]||i(n)}function h(t,e){l.aborted||s(t,function(t,n){e=e||"feature",w[n]=e,e in d||(d[e]=[])})}var y={},w={},b={on:o,addEventListener:o,removeEventListener:v,emit:n,get:g,listeners:m,context:e,buffer:h,abort:c,aborted:!1};return b}function o(t){return u(t,f,a)}function a(){return new r}function c(){(d.api||d.feature)&&(l.aborted=!0,d=l.backlog={})}var f="nr@context",u=t("gos"),s=t(10),d={},p={},l=e.exports=i();e.exports.getOrSetContext=o,l.backlog=d},{}],gos:[function(t,e,n){function r(t,e,n){if(i.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return t[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){i.buffer([t],r),i.emit(t,e,n)}var i=t("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,o,function(){return i++})}var i=1,o="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!T++){var t=P.info=NREUM.info,e=g.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(O,function(e,n){t[e]||(t[e]=n)});var n=a();c("mark",["onload",n+P.offset],null,"api"),c("timing",["load",n]);var r=g.createElement("script");0===t.agent.indexOf("http://")||0===t.agent.indexOf("https://")?r.src=t.agent:r.src=v+"://"+t.agent,e.parentNode.insertBefore(r,e)}}function i(){"complete"===g.readyState&&o()}function o(){c("mark",["domContent",a()+P.offset],null,"api")}var a=t(5),c=t("handle"),f=t(10),u=t("ee"),s=t(8),d=t(6),p=t(2),l=t(3),v=p.getConfiguration("ssl")===!1?"http":"https",m=window,g=m.document,h="addEventListener",y="attachEvent",w=m.XMLHttpRequest,b=w&&w.prototype,E=!d(m.location);NREUM.o={ST:setTimeout,SI:m.setImmediate,CT:clearTimeout,XHR:w,REQ:m.Request,EV:m.Event,PR:m.Promise,MO:m.MutationObserver};var x=""+location,O={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1212.min.js"},M=w&&b&&b[h]&&!/CriOS/.test(navigator.userAgent),P=e.exports={offset:a.getLastTimestamp(),now:a,origin:x,features:{},xhrWrappable:M,userAgent:s,disabled:E};if(!E){t(1),t(7),g[h]?(g[h]("DOMContentLoaded",o,l(!1)),m[h]("load",r,l(!1))):(g[y]("onreadystatechange",i),m[y]("onload",r)),c("mark",["firstbyte",a.getLastTimestamp()],null,"api");var T=0}},{}],"wrap-function":[function(t,e,n){function r(t,e){function n(e,n,r,f,u){function nrWrapper(){var o,a,s,p;try{a=this,o=d(arguments),s="function"==typeof r?r(o,a):r||{}}catch(l){i([l,"",[o,a,f],s],t)}c(n+"start",[o,a,f],s,u);try{return p=e.apply(a,o)}catch(v){throw c(n+"err",[o,a,v],s,u),v}finally{c(n+"end",[o,a,p],s,u)}}return a(e)?e:(n||(n=""),nrWrapper[p]=e,o(e,nrWrapper,t),nrWrapper)}function r(t,e,r,i,o){r||(r="");var c,f,u,s="-"===r.charAt(0);for(u=0;u<e.length;u++)f=e[u],c=t[f],a(c)||(t[f]=n(c,s?f+r:r,i,f,o))}function c(n,r,o,a){if(!v||e){var c=v;v=!0;try{t.emit(n,r,o,e,a)}catch(f){i([f,n,r,o],t)}v=c}}return t||(t=s),n.inPlace=r,n.flag=p,n}function i(t,e){e||(e=s);try{e.emit("internal-error",t)}catch(n){}}function o(t,e,n){if(Object.defineProperty&&Object.keys)try{var r=Object.keys(t);return r.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(o){i([o],n)}for(var a in t)l.call(t,a)&&(e[a]=t[a]);return e}function a(t){return!(t&&t instanceof Function&&t.apply&&!t[p])}function c(t,e){var n=e(t);return n[p]=t,o(t,n,s),n}function f(t,e,n){var r=t[e];t[e]=c(r,n)}function u(){for(var t=arguments.length,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n];return e}var s=t("ee"),d=t(11),p="nr@original",l=Object.prototype.hasOwnProperty,v=!1;e.exports=r,e.exports.wrapFunction=c,e.exports.wrapInPlace=f,e.exports.argsToArray=u},{}]},{},["loader"]);</script>
<title>Autoscaling TensorFlow Model Deployments with TF Serving and Kubernetes | Qwiklabs</title>
<script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"Malathi","lastname":"Sankar","fullname":"Malathi Sankar","company":"Login with Google","email":"malathi.sankar@glassdoor.com","origin":"googlecoursera-run, direct","subscriptions":0,"id":"bc62ac8b844c89c2a76d646f8d87f691","qlCreatedAt":"2021-07-25 15:38:02 UTC","optIn":null,"current_organization_id":null,"current_organization_role":null};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="googlecoursera-run";gon.content={"type":"Lab","id":3385,"name":"Autoscaling TensorFlow Model Deployments with TF Serving and Kubernetes"};
//]]>
</script>
<script>
  dataLayer = [
    {user: gon.current_user},
    {content: gon.content}
  ];
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-5XSKHDX");
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-60a166e60df2787cca5915e2ced8c317457f421a20f02601b937a72275ac441a.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-2beee108ba05276bc429223ee82ed81449d233c93d45af5da84add895e101218.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-ecc5d404d11fad634c575e0d758c10a28c1c888b39c56b402954f6ae42cb5740.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-6fcc8c1034b82ee07338fa26e3cced96cac2a94c0a0ad2546618c1841f20c8ec.js"></script>
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script type='application/ld+json'>
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gAhCpHSmc4lgRtcI882O9o57/76m7O/w/cJ+JzRtKgaadjoWdeN8aFBvwltQu8ypXrrDamq4IYlWySAyL7Qe9A==" />
<meta content='width=device-width, initial-scale=1.0, user-scalable=yes' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:0,&quot;variant&quot;:&quot;original&quot;}]' name='active-experiments'>
<meta content='{&quot;userId&quot;:5273467}' name='help-api-product-data'>
<meta content='AutoML Vision helps developers with limited ML expertise train high quality image recognition models. In this hands-on lab, you will learn how to train a custom model to recognize different types of clouds (cumulus, cumulonimbus, etc.).' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='Autoscaling TensorFlow Model Deployments with TF Serving and Kubernetes | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='AutoML Vision helps developers with limited ML expertise train high quality image recognition models. In this hands-on lab, you will learn how to train a custom model to recognize different types of clouds (cumulus, cumulonimbus, etc.).' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<meta property="og:url" content="https://googlecoursera.qwiklabs.com/focuses/19709284?parent=lti_session" /><link href="https://googlecoursera.qwiklabs.com/focuses/19709284?parent=lti_session" rel="canonical" />
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>
<link href='/favicon-32.png' rel='shortcut icon' type='image/x-icon'>



<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons" />


<link rel="stylesheet" media="all" href="https://cdn.qwiklabs.com/assets/application-8f527e22311eab257f648cbcc022bf8e488a53deb9786c8a0d8b518cf9c84d37.css" />

<style>
  :root {
    --primary-text-on-surface-color: #1a73e8;
    --primary-text-on-surface-color-dark: #1568d6;
    --primary-text-on-surface-color-darker: #135ec1;
    --primary-text-on-surface-color-darkest: #1154ac;
    --primary-surface-color: #1a73e8;
    --primary-surface-color-rgb: 26,115,232;
    --primary-surface-color-light: #d1e3fa;
    --primary-surface-color-lightest: #e8f1fd;
    --text-on-primary-color: #ffffff;
    --accent-text-on-surface-color: #f29900;
    --accent-surface-color: #f9ab00;
    --accent-surface-color-rgb: 249,171,0;
    --accent-surface-color-light: #ffefcc;
    --text-on-accent-color: #202124;
  }
</style>



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-5XSKHDX' style='display:none;visibility:hidden;' width='0'></iframe>
</noscript>
<div class='header-container'>
<div class='header'>
<ql-toolbar jumpEnabled>
<div class='header__title' slot='title'>
<ql-icon-button label="Back" href="https://googlecoursera.qwiklabs.com/focuses/19709284?parent=lti_session" id="e194c703fc523db0" target="_self" tip="Back">arrow_back</ql-icon-button>
<h1 class='ql-headline-6'>Autoscaling TensorFlow Model Deployments with TF Serving and Kubernetes</h1>
</div>
<div class='header__actions' slot='action'>
<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>
<ql-icon-button class='mobile-hide' icon='help_outline' id='help-menu-button' label='Open help menu' tip='Help'></ql-icon-button>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item data-analytics-action='opened_help' data-analytics-label='lab' label='Help Center' onclick='hallofmirrors.helpService.startHelp({&quot;productData&quot;:{&quot;userId&quot;:5273467},&quot;context&quot;:&quot;lab&quot;})'></ql-menu-item>
<ql-menu-item href='https://support.google.com/qwiklabs/contact/contact_us' label='Email support' target='_blank'></ql-menu-item>
<ql-menu-item label='Chat support' onClick='ql.chat.open()'></ql-menu-item>
</ql-menu>

<ql-icon-button class='mobile-hide' icon='language' id='language' label='Select your language preference' tip='Language'></ql-icon-button>
<ql-menu for='language'>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ar' href='/focuses/19709284?locale=ar&amp;parent=lti_session' label='العربية‬‎' lang='ar'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='de' href='/focuses/19709284?locale=de&amp;parent=lti_session' label='Deutsch' lang='de'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='en' href='/focuses/19709284?locale=en&amp;parent=lti_session' label='English' lang='en'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='es' href='/focuses/19709284?locale=es&amp;parent=lti_session' label='español (Latinoamérica)' lang='es'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr' href='/focuses/19709284?locale=fr&amp;parent=lti_session' label='français' lang='fr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='fr_CA' href='/focuses/19709284?locale=fr_CA&amp;parent=lti_session' label='français (Canada)' lang='fr-CA'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='he' href='/focuses/19709284?locale=he&amp;parent=lti_session' label='עברית' lang='he'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='id' href='/focuses/19709284?locale=id&amp;parent=lti_session' label='bahasa Indonesia' lang='id'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='it' href='/focuses/19709284?locale=it&amp;parent=lti_session' label='Italiano' lang='it'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ja' href='/focuses/19709284?locale=ja&amp;parent=lti_session' label='日本語' lang='ja'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ko' href='/focuses/19709284?locale=ko&amp;parent=lti_session' label='한국어' lang='ko'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pl' href='/focuses/19709284?locale=pl&amp;parent=lti_session' label='Polski' lang='pl'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_BR' href='/focuses/19709284?locale=pt_BR&amp;parent=lti_session' label='português (Brasil)' lang='pt-BR'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='pt_PT' href='/focuses/19709284?locale=pt_PT&amp;parent=lti_session' label='português (Portugal)' lang='pt-PT'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='ru' href='/focuses/19709284?locale=ru&amp;parent=lti_session' label='русский' lang='ru'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='tr' href='/focuses/19709284?locale=tr&amp;parent=lti_session' label='Türkçe' lang='tr'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh' href='/focuses/19709284?locale=zh&amp;parent=lti_session' label='简体中文' lang='zh'></ql-menu-item>
<ql-menu-item data-analytics-action='changed_locale' data-analytics-label='zh_TW' href='/focuses/19709284?locale=zh_TW&amp;parent=lti_session' label='繁體中文' lang='zh-TW'></ql-menu-item>
</ql-menu>

<ql-icon-button id='my_account' label='My account' tip='My account'>
<ql-avatar src='https://lh3.googleusercontent.com/a-/AOh14GhLpljoeONNlXwhoz1yzu0MpkWVsHcwScsbdhs6=s320-c'></ql-avatar>
</ql-icon-button>
<ql-menu for='my_account' id='my_account_menu' style='max-height: 640px'>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120' src='https://lh3.googleusercontent.com/a-/AOh14GhLpljoeONNlXwhoz1yzu0MpkWVsHcwScsbdhs6=s320-c'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-subhead-1'>Malathi Sankar</h4>
<p class='ql-body-2 text--light'>malathi.sankar@glassdoor.com</p>
<p class='ql-body-2 text--light'>
</p>
<a class="text--green ql-subhead-2" href="/my_account/payments"><ql-chip positive>
0 Credits
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a class="ql-caption text--light" href="/privacy_policy">Privacy</a>
<span class='ql-caption text--light l-mls l-mrs'>&middot;</span>
<a class="ql-caption text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</ql-toolbar>

</div>
<div class='header__search-bar js-header-search-bar'>
<form class="js-search-form-mobile" onsubmit="ql.searchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="3XF2qFpfbtplh8sqzhTrDnhJuzYq4AD45yvKHQpmIDxhMyft5NUdn8I3umXpleGSZwsFfQgQt70znm0oDAXjeQ==" />
<input type="text" name="keywords" id="search" placeholder="Search for learning activities." maxlength="255" aria-label="catalog search bar" />
</form>

<ql-icon-button class='js-close-search-bar'>close</ql-icon-button>
</div>
</div>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class="custom-logo">Qwiklabs</div>
</div>
<nav class='ql-sidenav'>
<ql-sidenav-item href='/' icon='home' label='Home'></ql-sidenav-item>

<ql-sidenav-item href='/catalog' icon='school' label='Catalog'></ql-sidenav-item>

<ql-sidenav-item href='/profile' icon='event_note' label='Profile'></ql-sidenav-item>

</nav>

</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main' id='jump-content'>
<div class='l-main-wrapper' id='main-wrapper'>




<div class='lab-assessment__tab js-open-lab-assessment-panel'>
<button class='js-lab-assessment-total-score'>
—/100
</button>
</div>
<div aria-labelledby='lab-assessment-checkpoint' class='lab-assessment__panel js-lab-assessment-panel' role='dialog'>
<div class='lab-assessment__panel__header'>
<h4 id='lab-assessment-checkpoint'>Checkpoints</h4>
<ql-icon-button class='js-close-lab-assessment-panel' icon='arrow_forward' label='Close dialog'></ql-icon-button>
</div>
<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a GKE cluster
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a GKE cluster' step_no='1'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-1'>
</span>
/ 20
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a storage bucket and upload model files into it
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a storage bucket and upload model files into it' step_no='2'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-2'>
</span>
/ 15
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a Kubernetes ConfigMap
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a Kubernetes ConfigMap' step_no='3'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-3'>
</span>
/ 15
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a TensorFlow Serving deployment
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a TensorFlow Serving deployment' step_no='4'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-4'>
</span>
/ 15
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Create a Kubernetes service
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Create a Kubernetes service' step_no='5'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-5'>
</span>
/ 15
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Add a horizontal pod autoscaler(HPA)
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Add a horizontal pod autoscaler(HPA)' step_no='6'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-6'>
</span>
/ 10
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title' id='lab-assessment-step-title'>
Start and monitor load test
</p>
<div class='lab-assessment__step__action'>
<ql-button class='js-show-run-step-button' description='Start and monitor load test' step_no='7'>
Check my progress
</ql-button>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-7'>
</span>
/ 10
</p>
</div>
</div>

</div>
<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Autoscaling TensorFlow Model Deployments with TF Serving and Kubernetes&quot;,&quot;lab_name&quot;:&quot;Autoscaling TensorFlow Model Deployments with TF Serving and Kubernetes&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;googlecoursera-run&quot;}' data-focus-id='19709284' data-lab-billing-limit='0.0' data-lab-duration='5400' data-parent='lti_session' data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer' style='width: calc(100% - 480px)'>
<iframe allow='clipboard-read' class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labDetails='[]' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:5400}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
             grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                    var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
            var element = document.getElementById(id);
            element.value = token;
          }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div aria-live='polite' class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<ql-snackbar id='alert-snackbar'></ql-snackbar>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message' role='alert'></p>
<ql-icon-button class='alert__close js-alert-close' icon='clear'></ql-icon-button>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='lab-content__renderable-instructions js-lab-content'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Autoscaling TensorFlow Model Deployments with TF Serving and Kubernetes
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>1 hour 30 minutes</span>
<span>Free</span>
<div class='lab__rating'>
<a aria-label="Lab Reviews" href="/focuses/19709284/reviews?parent=lti_session"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.5655'></div>

</a><ql-button aria-label='Rate Lab' id='rate-lab-btn' label='Rate Lab' text></ql-button>
</div>
</div>
</div>
<div class='lab-outline-place-holder'></div>

<div class='markdown-lab-instructions js-markdown-instructions' id='markdown-lab-instructions'>

<h2 id="step1">GSP777</h2>
<p><img alt="Google Cloud Self-Paced Labs" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>
<h2 id="step2">Overview</h2>
<p>Serving deep learning models can be especially challenging. The models are often large requiring gigabytes of memory. They are also
very compute intensive - a small number of concurrent requests can fully utilize a CPU or GPU. Automatic horizontal scaling is one of the primary
strategies used in architecting scalable and reliable model serving infrastructures for deep learning models.</p>
<p>In this lab, you will use <a href="https://www.tensorflow.org/tfx/guide/serving" target="_blank">TensorFlow Serving</a> and <a href="https://cloud.google.com/kubernetes-engine" target="_blank">Google Cloud Kubernetes Engine (GKE)</a> to configure a high-performance, autoscalable serving system for TensorFlow models.</p>
<h3>Objectives</h3>
<p>In this lab, you will learn how to:</p>
<ul>
<li>
<p>Configure a GKE cluster with an autoscaling node pool.</p>
</li>
<li>
<p>Deploy TensorFlow Serving in an autoscalable configuration.</p>
</li>
<li>
<p>Monitor serving performance and resource utilization</p>
</li>
</ul>
<h3>Prerequisites</h3>
<p>To successfully complete the lab you need to have a solid understanding of how to save and load TensorFlow models and a basic familiarity with Kubernetes concepts and architecture. Before proceeding with the lab it is recommended to review the following resources:</p>
<ul>
<li>
<p><a href="https://www.tensorflow.org/guide/saved_model" target="_blank">Using the SavedModel format</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/overview/" target="_blank">Kubernetes Overview</a></p>
</li>
</ul>
<h3>Lab scenario</h3>
<p>You will use <a href="https://www.tensorflow.org/tfx/serving/architecture" target="_blank">TensorFlow Serving</a> to deploy the <strong>ResNet101</strong> model. TensorFlow Serving is a flexible, high-performance serving system for machine learning models, designed for production environments. TensorFlow Serving makes it easy to deploy new algorithms and experiments, while keeping the same server architecture and APIs. TensorFlow Serving provides out-of-the-box integration with TensorFlow models, but can be easily extended to serve other types of models and data.</p>
<p>TensorFlow Serving can be run in a docker container and deployed and managed by Kubernetes. In the lab, you will deploy TensorFlow Serving as
a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank">Kubernetes Deployment</a> on Google Cloud Kubernetes Engine (GKE)  and use <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank">Kubernetes Horizontal Pod Autoscaler</a> to automatically scale the number of TensorFlow Serving replicas based on observed CPU utilization. You will also use <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler" target="_blank">GKE Cluster Autoscaler</a> to automatically resize your <strong>GKE</strong> cluster's node pool based on the resource demands generated
by the TensorFlow Serving Deployment.</p>
<p>Horizontal Pod Autoscaler automatically scales the number of Pods in a replication controller, deployment, replica set or stateful set based on observed CPU utilization (or, with custom metrics support, on some other application-provided metrics). Horizontal Pod Autoscaler is implemented as a Kubernetes API resource and a controller. The resource determines the behavior of the controller. The controller periodically adjusts the number of replicas in a replication controller or deployment to match the observed average CPU utilization to the target specified by user.</p>
<p>GKE's Cluster Autoscaler automatically resizes the number of nodes in a given node pool, based on the demands of your workloads. You don't need to manually add or remove nodes or over-provision your node pools. Instead, you specify a minimum and maximum size for the node pool, and the rest is automatic.</p>
<p>After configuring the cluster and deploying TensorFlow Serving you will use an open source load testing tool <a href="https://locust.io/" target="_blank">Locust</a> to generate
prediction requests against the <strong>ResNet101</strong> model and observe how the model deployment automatically scales up and down based on the load.</p>
<p>Summary of the tasks performed during the lab:</p>
<ul>
<li>
<p>Create a GKE cluster with autoscaling enabled on a default node pool</p>
</li>
<li>
<p>Deploy the pretrained <strong>ResNet101</strong> model using TensorFlow Serving</p>
</li>
<li>
<p>Configure Horizontal Pod Autoscaler</p>
</li>
<li>
<p>Install <strong>Locust</strong></p>
</li>
<li>
<p>Load the <strong>ResNet101</strong> model</p>
</li>
<li>
<p>Monitor the model deployment</p>
</li>
</ul>
<h2 id="step3">Setup and requirements</h2>
<h3><strong>Qwiklabs setup</strong></h3>
<h4>Before you click the Start Lab button</h4>
<p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click <strong>Start Lab</strong>, shows how long Google Cloud resources will be made available to you.</p>
<p>This hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<h4>What you need</h4>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
<li>Time to complete the lab.</li>
</ul>
<p><strong>Note:</strong> If you already have your own personal Google Cloud account or project, do not use it for this lab.</p>
<p><strong>Note:</strong> If you are using a Chrome OS device, open an Incognito window to run this lab.</p>
<h4>How to start your lab and sign in to the Google Cloud Console</h4>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is a panel populated with the temporary credentials that you must use for this lab.</p>
<p><img alt="Open Google Console" src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D"></p>
</li>
<li>
<p>Copy the username, and then click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Sign in</strong> page.</p>
<p><img alt="Sign in" src="https://cdn.qwiklabs.com/VkUIAFY2xX3zoHgmWqYKccRLwFrR4BfARLd5ojmlbhs%3D"></p>
<p><strong><em>Tip:</em></strong> Open the tabs in separate windows, side-by-side.</p>
<aside>
 If you see the <strong>Choose an account</strong> page, click <strong>Use Another Account</strong>.
<img alt="Choose an account" src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D">
</aside>
</li>
<li>
<p>In the <strong>Sign in</strong> page, paste the username that you copied from the left panel. Then copy and paste the password.</p>
<p><strong><em>Important:</em></strong> You must use the credentials from the left panel. Do not use your Google Cloud Training credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</p>
</li>
<li>
<p>Click through the subsequent pages:</p>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
</li>
</ol>
<p>After a few moments, the Cloud Console opens in this tab.</p>
<aside>
<strong>Note:</strong> You can view the menu with a list of Google Cloud Products and Services by clicking the <strong>Navigation menu</strong> at the top-left.
<img alt="Cloud Console Menu" src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D">
</aside>
<h3>Activate Cloud Shell</h3>
<p>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</p>
<p>In the Cloud Console, in the top right toolbar, click the <strong>Activate Cloud Shell</strong> button.</p>
<p><img alt="Cloud Shell icon" src="https://cdn.qwiklabs.com/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D"></p>
<p>Click <strong>Continue</strong>.</p>
<p><img alt="cloudshell_continue.png" src="https://cdn.qwiklabs.com/lr3PBRjWIrJ%2BMQnE8kCkOnRQQVgJnWSg4UWk16f0s%2FA%3D"></p>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><code>gcloud</code> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<p>You can list the active account name with this command:</p>
<ql-code-block language="plaintext">
gcloud auth list
</ql-code-block>
<p>(Output)</p>
<ql-code-block language="plaintext" output="">
Credentialed accounts:
 - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)
</ql-code-block>
<p>(Example output)</p>
<ql-code-block language="plaintext" output="">
Credentialed accounts:
 - google1623327_student@qwiklabs.net
</ql-code-block>
<p>You can list the project ID with this command:</p>
<ql-code-block language="plaintext">
gcloud config list project
</ql-code-block>
<p>(Output)</p>
<ql-code-block language="plaintext" output="">
[core]
project = &lt;project_ID&gt;
</ql-code-block>
<p>(Example output)</p>
<ql-code-block language="plaintext" output="">
[core]
project = qwiklabs-gcp-44776a13dea667a6
</ql-code-block>
<aside>
  For full documentation of <code>gcloud</code> see the <a href="https://cloud.google.com/sdk/gcloud" target="_blank">gcloud command-line tool overview</a>.
</aside>
<h2 id="step4">Lab tasks</h2>
<p>You will use <strong>Cloud Shell</strong> and <strong>Cloud Console</strong> for all of the tasks in the lab. Some tasks require you to edit text files. You can use any of the classic command line text
editors pre-installed in <strong>Cloud Shell</strong>, including <em>vim</em>, <em>emacs</em>, or <em>nano</em>. You can also use the built-in <a href="https://cloud.google.com/shell/docs/launching-cloud-shell-editor" target="_blank">Cloud Shell Editor</a>.</p>
<p>Before proceeding, make sure that you completed the <strong>Activate Cloud Shell</strong> step in the <strong>Qwiklabs setup</strong> instructions and your <strong>Cloud Shell</strong> is open and ready.</p>
<h3>Getting lab files</h3>
<p>Start by getting the lab files from GitHub:</p>
<ql-code-block language="plaintext">
cd
SRC_REPO=https://github.com/GoogleCloudPlatform/mlops-on-gcp
kpt pkg get $SRC_REPO/workshops/mlep-qwiklabs/tfserving-gke-autoscaling tfserving-gke
cd tfserving-gke
</ql-code-block>
<h3>Creating a GKE cluster</h3>
<p>Set the default compute zone and a couple of environment variables to store your project id and cluster name:</p>
<ql-code-block language="plaintext">
gcloud config set compute/zone us-central1-f
PROJECT_ID=$(gcloud config get-value project)
CLUSTER_NAME=cluster-1
</ql-code-block>
<p>To create a cluster execute the below command. It may take a few minutes to complete.</p>
<ql-code-block language="plaintext">
gcloud beta container clusters create $CLUSTER_NAME \
  --cluster-version=latest \
  --machine-type=n1-standard-4 \
  --enable-autoscaling \
  --min-nodes=1 \
  --max-nodes=3 \
  --num-nodes=1 
</ql-code-block>
<p>After the command completes you should see the ouput similar to one below:</p>
<p><img alt="cluster1" src="https://cdn.qwiklabs.com/FTZplgaIa4rp84QtI3JroTE9I%2FFNMD9kBW3w7rurv0s%3D"></p>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="1">
Create a GKE cluster
</ql-activity-tracking></p>
<p>The command created a CPU-based GKE cluster. The cluster has a default node pool, which is configured to autoscale from 1 to 3 nodes. Initially, the node pool has
only one node.</p>
<p>Get the credentials for you new cluster so you can interact with it using <code>kubectl</code>.</p>
<ql-code-block language="plaintext">
gcloud container clusters get-credentials $CLUSTER_NAME 
</ql-code-block>
<h3>Deploying ResNet101</h3>
<p>The pretrained ResNet101 model in the <code>SavedModel</code> format has been uploaded to a public Cloud Storage location.</p>
<p>You will first download the model files to a storage bucket in your project. Since storage buckets are a global resource in Google Cloud you have to use a unique bucket name. For the purpose of this lab, you can use your project id as a name prefix.</p>
<p>To create a storage bucket in your project:</p>
<ql-code-block language="plaintext">
export MODEL_BUCKET=${PROJECT_ID}-bucket
gsutil mb gs://${MODEL_BUCKET}
</ql-code-block>
<p>After the bucket has been created copy the model files:</p>
<ql-code-block language="plaintext">
gsutil cp -r gs://workshop-datasets/models/resnet_101 gs://${MODEL_BUCKET}
</ql-code-block>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="2">
Create a storage bucket and upload model files into it
</ql-activity-tracking></p>
<p>You are now ready to deploy TensorFlow Serving to GKE and configure it to serve the ResNet101 model.
You will deploy TF Serving in four steps:</p>
<ol>
<li>
<p>First you will create a <a href="https://kubernetes.io/docs/concepts/configuration/configmap/" target="_blank">Kubernetes ConfigMap</a> that points to the location of the ResNet101 model in your storage bucket</p>
</li>
<li>
<p>Then, you will create a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank">Kubernetes Deployment</a> using a <a href="https://hub.docker.com/r/tensorflow/serving" target="_blank">standard TensorFlow Serving image</a> from <strong>Docker Hub</strong>.</p>
</li>
<li>
<p>When the deployment is ready, you will create a <a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank">Kubernetes Service</a> to expose the deployment through a load balancer</p>
</li>
<li>
<p>Finally, you will configure Horizontal Pod Autoscaler</p>
</li>
</ol>
<h4>Creating ConfigMap</h4>
<p>Use your preferred command line editor or <strong>Cloud Shell Editor</strong> to update the <code>MODEL_PATH</code> field in the <code>tf-serving/configmap.yaml</code> file to reference your bucket. Recall that the bucket name was stored in the $MODEL_BUCKET environment variable:</p>
<ql-code-block language="plaintext">
echo $MODEL_BUCKET
</ql-code-block>
<p>After the update the <code>configmap.yaml</code> should look similar to the one below:</p>
<ql-code-block language="plaintext">
apiVersion: v1
kind: ConfigMap
metadata:
  name: tfserving-configs
data:
  MODEL_NAME: image_classifier
  MODEL_PATH: gs://qwiklabs-gcp-03-4b91a600a7a2-bucket/resnet_101
</ql-code-block>
<p>Using <code>kubectl</code> create the <em>ConfigMap</em>:</p>
<ql-code-block language="plaintext">
kubectl apply -f tf-serving/configmap.yaml
</ql-code-block>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="3">
Create a Kubernetes ConfigMap
</ql-activity-tracking></p>
<h4>Creating TensorFlow Serving deployment</h4>
<p>Inspect the manifest for the TensorFlow Serving deployment.</p>
<ql-code-block language="plaintext">
cat tf-serving/deployment.yaml
</ql-code-block>
<p>Notice that the TF Serving process is configured to serve the model referenced by the <code>MODEL_PATH</code> environment variable and that this variable is set by the <em>ConfigMap</em> you created in the previous step.</p>
<ql-code-block language="plaintext">
...
    spec:
      containers:
      - name: tf-serving
        image: "tensorflow/serving"
        args: 
        - "--model_name=$(MODEL_NAME)"
        - "--model_base_path=$(MODEL_PATH)" 
        envFrom:
        - configMapRef:
            name: tfserving-configs
...
</ql-code-block>
<p>Also notice that the deployment is configured to start with one replica.</p>
<ql-code-block language="plaintext">
...
apiVersion: apps/v1
kind: Deployment
metadata:
  name: image-classifier
  namespace: default
  labels:
    app: image-classifier
spec:
  replicas: 1
...
</ql-code-block>
<p>In the deployment manifest, there is an explicit request for CPU and RAM resources:</p>
<ql-code-block language="plaintext">
...
resources:
  requests:
    cpu: "3"
    memory: 4Gi
...
</ql-code-block>
<p>At start, each replica requests 3 CPUs and 4 Gigabytes of RAM. Your cluster is configured with <em>n1-standard-4</em> nodes that have 4 virtual CPUs and 15GB or RAM. It means that only a single replica can run on a node.</p>
<p>Create the deployment.</p>
<ql-code-block language="plaintext">
kubectl apply -f tf-serving/deployment.yaml
</ql-code-block>
<p>It may take a few minutes before the deployment is ready.</p>
<p>To check the status of the deployment:</p>
<ql-code-block language="plaintext">
kubectl get deployments
</ql-code-block>
<p>Wait till the <em>READY</em> column in the output of the previous command changes to <code>1/1</code>.</p>
<p><img alt="Deployment ready" src="https://cdn.qwiklabs.com/Zi6GHH%2BHbQROJy6dnsyy5gqatA2MMpzTBelDcx6cXGQ%3D"></p>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="4">
Create a TensorFlow Serving deployment
</ql-activity-tracking></p>
<h4>Exposing the deployment</h4>
<p>Inspect the manifest for the service:</p>
<ql-code-block language="plaintext">
cat tf-serving/service.yaml
</ql-code-block>
<p>Notice that the service is of type <code>LoadBalancer</code> and that it exposes two ports: 8500 and 8501. By default,  Tensorflow Serving uses port 8500 for the gRPC interface and port 8501 for the REST interface.</p>
<ql-code-block language="plaintext">
...
spec:
  type: LoadBalancer
  ports:
  - port: 8500
    protocol: TCP
    name: tf-serving-grpc
  - port: 8501
    protocol: TCP
    name: tf-serving-http
  selector:
    app: image-classifier
...
</ql-code-block>
<p>Create the service:</p>
<ql-code-block language="plaintext">
kubectl apply -f tf-serving/service.yaml
</ql-code-block>
<p>It may take a few minutes before the service is operational. Wait till the external IP address exposed by the service has been set. You can check the status of provisioning the service by executing the following command:</p>
<ql-code-block language="plaintext">
kubectl get svc image-classifier
</ql-code-block>
<p>When the service is ready you should see the output similar to the one below:</p>
<p><img alt="Service created" src="https://cdn.qwiklabs.com/tw4kv9mtDMYeDqChtnLfEXRHVf0xyVHDlsJwtATpG%2FM%3D"></p>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="5">
Create a Kubernetes service
</ql-activity-tracking></p>
<h4>Configuring horizontal pod autoscaler</h4>
<p>The final step is to add Horizontal Pod Autoscaler (HPA). The below command configures HPA to start a new replica of  TensorFlow Serving  whenever the mean CPU utilization across all already running replicas reaches 60%. HPA will attempt to create up to 4 replicas and and scale down to 1 replica.</p>
<ql-code-block language="plaintext">
kubectl autoscale deployment image-classifier \
--cpu-percent=60 \
--min=1 \
--max=4 
</ql-code-block>
<p>To check the status of the HPA.</p>
<ql-code-block language="plaintext">
kubectl get hpa
</ql-code-block>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="6">
Add a horizontal pod autoscaler(HPA)
</ql-activity-tracking></p>
<h4>Testing the model</h4>
<p>The Tensorflow Serving model server is now up and running. You can test it by submitting a request using the <code>curl</code> command. In the <code>locust</code> folder you can find a sample request body (<code>request-body.json</code>) formatted to conform to the <a href="https://www.tensorflow.org/tfx/serving/api_rest" target="_blank">TensorFlow Serving REST API</a>. It contains the picture of <a href="https://en.wikipedia.org/wiki/Grace_Hopper" target="_blank">Grace Hopper</a>.</p>
<p><img alt="Grace Hopper" src="https://cdn.qwiklabs.com/qMptc0dlcDsJcoq0f%2BWfRz2Trjln%2FCTHwCiMPHrbcTA%3D"></p>
<p>To invoke the model  set the <code>EXTERNAL_IP</code> environment variable to the external IP of your servce and execute the <code>curl</code> command:</p>
<ql-code-block language="plaintext">
EXTERNAL_IP=[YOUR_SERVICE_IP]
curl -d @locust/request-body.json -X POST http://${EXTERNAL_IP}:8501/v1/models/image_classifier:predict
</ql-code-block>
<p>The response returned by the model includes the list of 5 most likely labels with the associated probabilities. The response should look similar to the one below:</p>
<p><img alt="Model response" src="https://cdn.qwiklabs.com/dSBAap4dyJgJZmzVC7PGXlJa835TcnT5hVZsaO6PAkY%3D"></p>
<h3>Installing Locust</h3>
<p>You are now ready to load test the ResNet101 model. As described previously, you will use an open source load testing tool <a href="https://locust.io/" target="_blank">Locust</a> to generate prediction requests.</p>
<p>To install Locust:</p>
<ql-code-block language="plaintext">
pip3 install locust==1.4.1
</ql-code-block>
<p>The installation process can take a few minutes. The Locust command line interface (CLI) gets installed into the <code>~/.local/bin</code> folder which is not on <em>PATH</em>. You need to add this folder to <em>PATH</em>:</p>
<ql-code-block language="plaintext">
export PATH=~/.local/bin:$PATH
</ql-code-block>
<p>To validate the installation and show the Locust version number:</p>
<ql-code-block language="plaintext">
locust -V
</ql-code-block>
<h3>Starting a load test</h3>
<p>The <code>locust</code> folder contains the Locust script that generates prediction requests against the ResNet101 model. The script uses the same request body you used previously to verify the TensorFlow Serving deployment. The script is configured to progressively increase the number of simulated users that send prediction requests to the ResNet101 model. After reaching the maximum number of configured users, the script stops generating the load. The number of users is adjusted every 60s.</p>
<p>Refer to <a href="https://docs.locust.io" target="_blank">Locust documentation</a> for more information on Locust settings.</p>
<p>To start the test execute the below command.</p>
<ql-code-block language="plaintext">
cd locust
locust -f tasks.py \
--headless \
--host http://${EXTERNAL_IP}:8501
</ql-code-block>
<h3>Monitoring the load test</h3>
<p>You will monitor the behavior of the TensorFlow Serving deployment and the GKE node pool using <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/dashboards" target="_blank">GKE Dashboards</a>.</p>
<p>To monitor the TensorFlow Serving deployment open a new tab in the same browser window in which you run Cloud Shell and navigate to the following URL:</p>
<ql-code-block language="plaintext">
https://console.cloud.google.com/kubernetes/deployment/us-central1-f/cluster-1/default/image-classifier/overview
</ql-code-block>
<p>You should see the page similar to one below:</p>
<p><img alt="Workload tab" src="https://cdn.qwiklabs.com/RN1LH%2FMOOT8TJ89X3N6dLVRjVc1HhxVAjWzbJuHL4i8%3D"></p>
<p>Two lines on the <em>CPU line chart</em> in the upper left part of the page show the requested and the currently utilized CPUs. As the load increases, the number of requested CPUs will increase in steps of 3 as new replicas are started. The number of used CPUs will be a ragged curve representing the current utilization averaged across all allocated CPU resources.  The <em>CPU line chart</em> shows data delayed by about 60 seconds.</p>
<p>Note that you need to click on the <em>Refresh</em> button on the top menu to see the updates.</p>
<p>The <em>Managed pods</em> widget shows the currrent number of replicas. At the beginning of the test it will show one replica:</p>
<p><img alt="1 pod" src="https://cdn.qwiklabs.com/j%2FYbMJEK005MTSDf6UBMMx8goxRZj6PpuiAWc35qqv8%3D"></p>
<p>Soon you will see two pods. One running and one in the <em>unschedulable</em> state:</p>
<p><img alt="2 pods" src="https://cdn.qwiklabs.com/bEqh8mAHDhBRrx2FHe7XocwceafQlhM10mHjtnLC09U%3D"></p>
<p>Recall that only one TensorFlow Serving pod can fit on a single cluster node. The pod stays in the <em>unschedulable state</em> while GKE autoscaler creates a new node. After both pods are in the running state you can verify that a new node has been created in the default node pool by opening the node pool dashboard in another browser tab.</p>
<ql-code-block language="plaintext">
https://console.cloud.google.com/kubernetes/nodepool/us-central1-f/cluster-1/default-pool
</ql-code-block>
<p><img alt="Node pool tab" src="https://cdn.qwiklabs.com/rcCyLfm6Esn7WfLZDT%2Fv5jaPr06BmpBqceqCJb%2FHOGY%3D"></p>
<p>At some point the forth replica is scheduled:</p>
<p><img alt="4 pods" src="https://cdn.qwiklabs.com/D1tP0fS2IxpMVEb2d%2F90IN1zk0vrofdVE0M7%2Bv697Pc%3D"></p>
<p>The forth replica will not transition to the running state as the GKE autoscaler was configured to create a maximum of three nodes.</p>
<p>After about 15 minutes, the script stops sending requests. As a result, the number of TensorFlow Serving replicas will also go down.</p>
<p>By default, the HPA will wait for 5 minutes before triggering the downscaling operation so you will need to wait at least 5 minutes to observe this behavior.</p>
<p>As the number of replicas goes down, the GKE autoscaler starts removing nodes from the default node pool.</p>
<p>For the purposes of scaling down, the autoscaler calculates the group's recommended target size based on peak load over the last 10 minutes. These last 10 minutes are referred to as the <strong>stabilization period</strong>. So be patient. It will take over 15 minutes after the script stopped generating predictions to see the changes in the size of the default node pool.</p>
<p>Click <em>Check my progress</em> to verify the objective.
<ql-activity-tracking step="7">
Start and monitor load test
</ql-activity-tracking></p>
<h3>Stopping the load test</h3>
<p>To stop the load test kill the Locust process by issuing the <em>Ctrl+C</em> command in the Cloud Shell terminal.</p>
<h2 id="step5">Congratulations</h2>
<p>You used <strong>TensorFlow Serving</strong> and <strong>Google Kubernetes Engine</strong> to deploy and monitor the <strong>ResNet101</strong> model!</p>
<h3>Finish your Quest</h3>
<p>This self-paced lab is part of Qwiklabs <a href="https://www.cloudskillsboost.google/quests/84" target="_blank">Advanced ML: ML Infrastructure</a> Quest. A Quest is a series of related labs that form a learning path. Completing a Quest earns you a badge to recognize your achievement. You can make your badge (or badges) public and link to them in your online resume or social media account. <a href="https://www.cloudskillsboost.google/quests/84/enroll" target="_blank">Enroll in this Quest</a> and get immediate completion credit for taking this lab.  <a href="https://google.qwiklabs.com/catalog" target="_blank">See other available Qwiklabs Quests</a>.</p>

<h3>Google Cloud Training &amp; Certification</h3>
<p>...helps you make the most of Google Cloud technologies. <a href="https://cloud.google.com/training/courses" target="_blank">Our classes</a> include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. <a href="https://cloud.google.com/certification/" target="_blank">Certifications</a> help you validate and prove your skill and expertise in Google Cloud technologies.</p>
<h5>Manual Last Updated October 19, 2021</h5>
<h5>Lab Last Tested October 19, 2021</h5>
<p>Copyright 2021 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>

</div>
</div>


<div class='lab-content__end-lab-button js-end-lab-button-container hidden'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
</ql-drawer-content>
<ql-drawer end id='outline-drawer' open slot='drawer' width='320'>
<div aria-label='Lab Table of Contents' role='navigation'>
<ul class='lab-content__outline js-lab-content-outline'>
<li><a href='#step1'>GSP777</a></li><li><a href='#step2'>Overview</a></li><li><a href='#step3'>Setup and requirements</a></li><li><a href='#step4'>Lab tasks</a></li><li><a href='#step5'>Congratulations</a></li>
</ul>
</div>
</ql-drawer>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>



</div>
</main>

<span class='hidden' id='flash-sibling-before'></span>
<div class='flash alert alert-success' role='alert'>
<p class='alert__message'>
Account for malathi.sankar@glassdoor.com has been updated
</p>
<a class='alert__close' data-dismiss='alert'>
<i class='fa fas fa-times'></i>
</a>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<ql-snackbar></ql-snackbar>


<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='modal-content mdl-shadow--24dp'>
<div class='modal-body'>
<p class='l-mbm'>
AutoML Vision helps developers with limited ML expertise train high quality image recognition models. In this hands-on lab, you will learn how to train a custom model to recognize different types of clouds (cumulus, cumulonimbus, etc.).
</p>
<p>
This lab is included in the quest
<a href="/quests/84">Advanced ML: ML Infrastructure</a>.
If you complete this lab you&#39;ll receive credit for it when you enroll in this quest.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
90m access
&middot;
90m completion
</p>
<p class='small-label l-mbs'>
<strong>AWS Region:</strong>
[] <strong></strong>
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>advanced</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://googlecoursera.qwiklabs.com/catalog_lab/3385">https://googlecoursera.qwiklabs.com/catalog_lab/3385</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<ql-dialog headline='How satisfied are you with this lab?&lt;span aria-hidden=&quot;true&quot;&gt;*&lt;/span&gt;' id='lab-review-dialog'>
<form class="simple_form js-lab-review-form" id="new_lab_review" action="/lab_reviews" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div aria-labelledby='lab-review-dialog' aria-required='true' aria-valuemax='5' aria-valuemin='0' aria-valuenow='0' class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='0' id='lab-review-rateit' role='slider' tabindex='0'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="5273467" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="3385" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Additional Comments</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</form><ql-button disabled id='submit' label='Submit' slot='action' text></ql-button>
</ql-dialog>

<ql-dialog headline='All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?' icon='error_outline' id='js-lab-are-you-sure-dialog'>
<ql-button id='js-are-you-sure-button' label='Submit' slot='action' text></ql-button>
</ql-dialog>


<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.chat.init();
  ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  initLabReviewTranslations( {"star_amount_1":"1 of 5 stars","star_amount_2":"2 of 5 stars","star_amount_3":"3 of 5 stars","star_amount_4":"4 of 5 stars","star_amount_5":"5 of 5 stars"} )
  ql.labAssessment.init();
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.initHeader();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

